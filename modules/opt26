#!/bin/bash
# Written in Bash
# "ONLY FOR EDUCATIONAL PURPOSE"
# OPTION 26: LAUNCH AN APPLICATION - ANDRO-EYE

# Color codes
RED='\033[0;91m'
GREEN='\033[0;92m'
YELLOW='\033[0;93m'
BLUE='\033[0;94m'
PURPLE='\033[0;95m'
CYAN='\033[0;96m'
WHITE='\033[0;97m'
NC='\033[0m' # No Color
BOLD='\033[1m'
UNDERLINE='\033[4m'
BLINK='\033[5m'

# Animation functions
loading_animation() {
    local message=$1
    local chars="â ‹â ™â ¹â ¸â ¼â ´â ¦â §â ‡â "
    
    echo -ne "${CYAN}${BOLD}$message ${NC}"
    for i in {1..15}; do
        for char in $(echo $chars | grep -o .); do
            echo -ne "${YELLOW}${BOLD}$char${NC}"
            sleep 0.05
            echo -ne "\b"
        done
    done
    echo -e "${GREEN}${BOLD} Done! ${NC}"
}

progress_bar() {
    local duration=$1
    local message=$2
    local width=40
    
    echo -ne "${BLUE}${BOLD}$message ${NC}"
    for ((i=0; i<=width; i++)); do
        local percent=$((i * 100 / width))
        echo -ne "\r${BLUE}${BOLD}$message ${NC}["
        for ((j=0; j<i; j++)); do echo -ne "${GREEN}â–“${NC}"; done
        for ((j=i; j<width; j++)); do echo -ne "${WHITE}â–‘${NC}"; done
        echo -ne "] ${percent}%"
        sleep $(echo "scale=2; $duration/width" | bc 2>/dev/null || echo "0.05")
    done
    echo -e "\n"
}

sparkle_effect() {
    echo -ne "${YELLOW}"
    for i in {1..15}; do
        echo -ne "âœ¦"
        sleep 0.03
    done
    echo -e "${NC}"
}

pulse_message() {
    local message=$1
    local color=$2
    
    for i in {1..3}; do
        echo -ne "${color}${BOLD}$message${NC}"
        sleep 0.2
        echo -ne "\r"
        for j in $(seq 1 ${#message}); do
            echo -n " "
        done
        echo -ne "\r"
        sleep 0.2
    done
    echo -e "${color}${BOLD}$message${NC}"
}

# Function to display device in a box
display_device_box() {
    local number=$1
    local device=$2
    local model=$3
    local status=$4
    
    echo -e "${YELLOW}${BOLD}â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”${NC}"
    echo -e "${YELLOW}${BOLD}â”‚${NC}  ${GREEN}${BOLD}DEVICE #${number}${NC}                                        ${YELLOW}â”‚${NC}"
    echo -e "${YELLOW}${BOLD}â”‚${NC}      ${CYAN}ID:${NC} ${WHITE}${device:0:15}...${NC}                     ${YELLOW}â”‚${NC}"
    echo -e "${YELLOW}${BOLD}â”‚${NC}      ${PURPLE}Model:${NC} ${WHITE}$model${NC}                                 ${YELLOW}â”‚${NC}"
    echo -e "${YELLOW}${BOLD}â”‚${NC}      ${BLUE}Status:${NC} $status                           ${YELLOW}â”‚${NC}"
    echo -e "${YELLOW}${BOLD}â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜${NC}"
}

# Function to list installed packages with search
list_packages() {
    local device=$1
    local model=$2
    
    echo -e "\n${CYAN}${BOLD}ğŸ“‹ Fetching installed packages from ${WHITE}$model${NC}..."
    loading_animation "Please wait"
    
    # Get package list
    local pkg_list=$(adb -s "$device" shell pm list packages 2>/dev/null | sed 's/package://g' | sort)
    local pkg_count=$(echo "$pkg_list" | wc -l)
    
    echo -e "\n${GREEN}${BOLD}âœ… Found ${WHITE}$pkg_count${GREEN} installed packages${NC}"
    
    # Save to temp file for searching
    echo "$pkg_list" > ".temp/pkglist_$$.tmp"
    
    # Interactive search
    while true; do
        echo -e "\n${YELLOW}${BOLD}ğŸ” Package Search Options:${NC}"
        echo -e "${BLUE}${BOLD}â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€${NC}"
        echo -e "  ${GREEN}1.${NC} ${WHITE}Search by keyword${NC}"
        echo -e "  ${GREEN}2.${NC} ${WHITE}Show all packages${NC}"
        echo -e "  ${GREEN}3.${NC} ${WHITE}Filter by common prefixes${NC}"
        echo -e "  ${GREEN}4.${NC} ${WHITE}Show recently installed${NC}"
        echo -e "  ${GREEN}5.${NC} ${WHITE}Exit search${NC}"
        echo -e "${BLUE}${BOLD}â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€${NC}\n"
        
        echo -ne "${YELLOW}${BOLD}Select option (1-5) ${WHITE}â¤${NC} ${RED}"
        read search_opt
        echo -ne "${NC}"
        
        case $search_opt in
            1)
                echo -ne "\n${CYAN}${BOLD}Enter search keyword ${WHITE}â¤${NC} ${RED}"
                read keyword
                echo -ne "${NC}"
                
                if [ -n "$keyword" ]; then
                    echo -e "\n${GREEN}${BOLD}Packages matching '${WHITE}$keyword${GREEN}':${NC}"
                    grep -i "$keyword" ".temp/pkglist_$$.tmp" | while read pkg; do
                        echo -e "  ${GREEN}â€¢${NC} ${WHITE}$pkg${NC}"
                    done | head -50
                    
                    local match_count=$(grep -i "$keyword" ".temp/pkglist_$$.tmp" | wc -l)
                    echo -e "\n${YELLOW}${BOLD}Found ${WHITE}$match_count${YELLOW} matches${NC}"
                fi
                ;;
            2)
                echo -e "\n${GREEN}${BOLD}First 50 packages:${NC}"
                head -50 ".temp/pkglist_$$.tmp" | while read pkg; do
                    echo -e "  ${GREEN}â€¢${NC} ${WHITE}$pkg${NC}"
                done
                echo -e "\n${YELLOW}${BOLD}... and $(($pkg_count - 50)) more${NC}"
                ;;
            3)
                echo -e "\n${CYAN}${BOLD}Common package prefixes:${NC}"
                echo -e "  ${GREEN}â€¢${NC} ${WHITE}com.android.${NC} - System apps"
                echo -e "  ${GREEN}â€¢${NC} ${WHITE}com.google.${NC} - Google apps"
                echo -e "  ${GREEN}â€¢${NC} ${WHITE}com.samsung.${NC} - Samsung apps"
                echo -e "  ${GREEN}â€¢${NC} ${WHITE}com.whatsapp${NC} - WhatsApp"
                echo -e "  ${GREEN}â€¢${NC} ${WHITE}com.facebook${NC} - Facebook"
                echo -e "  ${GREEN}â€¢${NC} ${WHITE}com.instagram${NC} - Instagram"
                echo -e "  ${GREEN}â€¢${NC} ${WHITE}org.telegram${NC} - Telegram"
                
                echo -ne "\n${YELLOW}${BOLD}Enter prefix ${WHITE}â¤${NC} ${RED}"
                read prefix
                echo -ne "${NC}"
                
                if [ -n "$prefix" ]; then
                    echo -e "\n${GREEN}${BOLD}Packages starting with '${WHITE}$prefix${GREEN}':${NC}"
                    grep "^$prefix" ".temp/pkglist_$$.tmp" | head -30 | while read pkg; do
                        echo -e "  ${GREEN}â€¢${NC} ${WHITE}$pkg${NC}"
                    done
                fi
                ;;
            4)
                echo -e "\n${GREEN}${BOLD}Recently installed (last 20):${NC}"
                # This is an approximation - actual recent installs would need more info
                tail -20 ".temp/pkglist_$$.tmp" | while read pkg; do
                    echo -e "  ${GREEN}â€¢${NC} ${WHITE}$pkg${NC}"
                done
                ;;
            5)
                break
                ;;
        esac
        
        echo -e "\n${YELLOW}${BOLD}Press Enter to continue...${NC}"
        read
    done
    
    # Cleanup
    rm -f ".temp/pkglist_$$.tmp"
    
    # Return the full list for reference
    echo "$pkg_list"
}

# Function to get app info
get_app_info() {
    local device=$1
    local package=$2
    
    echo -e "\n${CYAN}${BOLD}ğŸ“± App Information:${NC}"
    echo -e "${BLUE}${BOLD}â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€${NC}"
    
    # Get app name
    local app_name=$(adb -s "$device" shell pm list packages -f 2>/dev/null | grep "$package" | head -1 | awk -F= '{print $2}')
    echo -e "  ${GREEN}â€¢${NC} ${WHITE}Package: ${YELLOW}$package${NC}"
    echo -e "  ${GREEN}â€¢${NC} ${WHITE}App Name: ${YELLOW}$app_name${NC}"
    
    # Get app version
    local version=$(adb -s "$device" shell dumpsys package "$package" 2>/dev/null | grep versionName | head -1 | cut -d= -f2)
    [ -n "$version" ] && echo -e "  ${GREEN}â€¢${NC} ${WHITE}Version: ${YELLOW}$version${NC}"
    
    # Get install location
    local install_loc=$(adb -s "$device" shell pm path "$package" 2>/dev/null | head -1)
    [ -n "$install_loc" ] && echo -e "  ${GREEN}â€¢${NC} ${WHITE}Path: ${YELLOW}$install_loc${NC}"
    
    # Get app enabled status
    local enabled=$(adb -s "$device" shell pm list packages -e 2>/dev/null | grep -c "$package")
    if [ $enabled -gt 0 ]; then
        echo -e "  ${GREEN}â€¢${NC} ${WHITE}Status: ${GREEN}Enabled${NC}"
    else
        echo -e "  ${GREEN}â€¢${NC} ${WHITE}Status: ${RED}Disabled${NC}"
    fi
    
    echo -e "${BLUE}${BOLD}â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€${NC}"
}

# Function to launch app with animation
launch_app() {
    local device=$1
    local model=$2
    local package=$3
    
    echo -e "\n${YELLOW}${BOLD}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
    echo -e "${PURPLE}${BOLD}ğŸš€ Launching app on:${NC}"
    display_device_box "-" "$device" "$model" "${GREEN}â— Launching${NC}"
    
    # Show app info
    get_app_info "$device" "$package"
    
    # Check if package exists
    echo -e "\n${BLUE}${BOLD}ğŸ” Verifying package installation...${NC}"
    if ! adb -s "$device" shell pm list packages | grep -q "$package"; then
        pulse_message "âŒ Package '$package' not found on device!" "${RED}"
        return 1
    fi
    echo -e "${GREEN}${BOLD}âœ“ Package found${NC}"
    
    # Launch animation
    echo -e "\n${CYAN}${BOLD}âš¡ Launching application...${NC}\n"
    
    local spin='-\|/'
    local i=0
    
    # Launch the app
    adb -s "$device" shell monkey -p "$package" -c android.intent.category.LAUNCHER 1 > /dev/null 2>&1 &
    local pid=$!
    
    # Show animation while launching
    while kill -0 $pid 2>/dev/null; do
        i=$(( (i+1) % 4 ))
        printf "\r${YELLOW}${BOLD}â³ Launching ${spin:$i:1} ${NC}"
        sleep 0.1
    done
    
    wait $pid 2>/dev/null
    local result=$?
    
    if [ $result -eq 0 ]; then
        echo -e "\r${GREEN}${BOLD}âœ… Application launched successfully!          ${NC}\n"
        
        # Get activity info if available
        local activity=$(adb -s "$device" shell dumpsys package "$package" 2>/dev/null | grep -A 1 "MAIN" | grep "$package" | head -1 | awk '{print $2}')
        if [ -n "$activity" ]; then
            echo -e "${CYAN}${BOLD}ğŸ“Œ Launched activity: ${WHITE}$activity${NC}"
        fi
        
        sparkle_effect
    else
        echo -e "\r${RED}${BOLD}âŒ Failed to launch application${NC}\n"
    fi
}

# Clear screen and show banner
clear
echo -e "${BLUE}${BOLD}"
cat << "EOF"
    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
    â•‘  â–ˆâ–ˆâ•—      â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•—  â–ˆâ–ˆâ•—    â•‘
    â•‘  â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘    â•‘
    â•‘  â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â–ˆâ–ˆâ•— â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘    â•‘
    â•‘  â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘    â•‘
    â•‘  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘ â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘    â•‘
    â•‘  â•šâ•â•â•â•â•â•â•â•šâ•â•  â•šâ•â• â•šâ•â•â•â•â•â• â•šâ•â•  â•šâ•â•â•â• â•šâ•â•â•â•â•â•â•šâ•â•  â•šâ•â•    â•‘
    â•‘                                                          â•‘
    â•‘        ğŸš€ ${GREEN}APPLICATION LAUNCHER${BLUE} - ${CYAN}App Starter${BLUE}                  â•‘
    â•‘                                                          â•‘
    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
EOF
echo -e "${NC}"
sparkle_effect

# Create necessary directories
mkdir -p .temp 2>/dev/null

## DEVICE ID EXTRACT ##
echo -e "\n${BLUE}${BOLD}ğŸ” Scanning for connected devices...${NC}"
loading_animation "Detecting devices"

# Check if ADB is working
if ! command -v adb &> /dev/null; then
    pulse_message "âŒ ADB not found! Please install ADB first." "${RED}"
    sleep 2
    bash modules/funtion.sh
    exit 1
fi

adb devices | sed -n '2,$p' | awk '{ print $1 }' > .temp/dev_list_temp 2>/dev/null

# Check if any devices found
if [ ! -s ".temp/dev_list_temp" ]; then
    echo -e "\n${RED}${BOLD}â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”${NC}"
    echo -e "${RED}${BOLD}â”‚${NC}  ${RED}${BLINK}âš ï¸${NC}  ${WHITE}NO DEVICES CONNECTED${NC}                       ${RED}${BOLD}â”‚${NC}"
    echo -e "${RED}${BOLD}â”‚${NC}      ${CYAN}Please connect a device to launch apps${NC}                 ${RED}${BOLD}â”‚${NC}"
    echo -e "${RED}${BOLD}â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜${NC}"
    
    echo -e "\n${YELLOW}${BOLD}Press Enter to return to main menu...${NC}"
    read
    clear
    bash modules/funtion.sh
    exit 0
fi

# Read devices into array properly
mapfile -t dev < .temp/dev_list_temp 2>/dev/null

# Assign device variables with null checking
dev_1="${dev[0]:-}"
dev_2="${dev[1]:-}"
dev_3="${dev[2]:-}"

## DEVICE MODEL EXTRACT ##
adb devices -l | grep "model:" > .temp/dev_list_model_temp 2>/dev/null

# Extract models properly
mod_1=""
mod_2=""
mod_3=""

if [ -s ".temp/dev_list_model_temp" ]; then
    mapfile -t model_lines < .temp/dev_list_model_temp
    
    for i in "${!model_lines[@]}"; do
        model=$(echo "${model_lines[$i]}" | grep -o 'model:[^ ]*' | cut -d':' -f2)
        
        case $i in
            0) mod_1="$model" ;;
            1) mod_2="$model" ;;
            2) mod_3="$model" ;;
        esac
    done
fi

# Proper device count logic
total_dev=0
[ -n "$dev_1" ] && total_dev=1
[ -n "$dev_2" ] && total_dev=2
[ -n "$dev_3" ] && total_dev=3

# Device launch functions
dev_1_launch() {
    local package_name=""
    
    echo -e "\n${YELLOW}${BOLD}ğŸ“± Selected device: ${WHITE}$mod_1${NC}"
    
    # Ask if user wants to search for apps
    echo -ne "\n${CYAN}${BOLD}â“ Search for installed apps? ${WHITE}(y/N) ${CYAN}â¤ ${RED}"
    read search_choice
    echo -ne "${NC}"
    
    case ${search_choice,,} in
        y|yes)
            list_packages "$dev_1" "$mod_1" > /dev/null
            ;;
    esac
    
    # Get package name
    while true; do
        echo -ne "\n${YELLOW}${BOLD}Enter package name ${WHITE}â¤${NC} ${RED}"
        read package_name
        echo -ne "${NC}"
        
        if [ -z "$package_name" ]; then
            pulse_message "âŒ Package name cannot be empty!" "${RED}"
        else
            break
        fi
    done
    
    launch_app "$dev_1" "$mod_1" "$package_name"
}

dev_2_launch() {
    local package_name=""
    
    echo -e "\n${YELLOW}${BOLD}ğŸ“± Selected device: ${WHITE}$mod_2${NC}"
    
    # Ask if user wants to search for apps
    echo -ne "\n${CYAN}${BOLD}â“ Search for installed apps? ${WHITE}(y/N) ${CYAN}â¤ ${RED}"
    read search_choice
    echo -ne "${NC}"
    
    case ${search_choice,,} in
        y|yes)
            list_packages "$dev_2" "$mod_2" > /dev/null
            ;;
    esac
    
    # Get package name
    while true; do
        echo -ne "\n${YELLOW}${BOLD}Enter package name ${WHITE}â¤${NC} ${RED}"
        read package_name
        echo -ne "${NC}"
        
        if [ -z "$package_name" ]; then
            pulse_message "âŒ Package name cannot be empty!" "${RED}"
        else
            break
        fi
    done
    
    launch_app "$dev_2" "$mod_2" "$package_name"
}

dev_3_launch() {
    local package_name=""
    
    echo -e "\n${YELLOW}${BOLD}ğŸ“± Selected device: ${WHITE}$mod_3${NC}"
    
    # Ask if user wants to search for apps
    echo -ne "\n${CYAN}${BOLD}â“ Search for installed apps? ${WHITE}(y/N) ${CYAN}â¤ ${RED}"
    read search_choice
    echo -ne "${NC}"
    
    case ${search_choice,,} in
        y|yes)
            list_packages "$dev_3" "$mod_3" > /dev/null
            ;;
    esac
    
    # Get package name
    while true; do
        echo -ne "\n${YELLOW}${BOLD}Enter package name ${WHITE}â¤${NC} ${RED}"
        read package_name
        echo -ne "${NC}"
        
        if [ -z "$package_name" ]; then
            pulse_message "âŒ Package name cannot be empty!" "${RED}"
        else
            break
        fi
    done
    
    launch_app "$dev_3" "$mod_3" "$package_name"
}

# Main device selection logic
echo -e "\n${GREEN}${BOLD}âœ… Scan Complete! Found ${WHITE}$total_dev${GREEN} device(s)${NC}\n"

# Show common package examples
echo -e "${CYAN}${BOLD}ğŸ’¡ Common package names:${NC}"
echo -e "  ${GREEN}â€¢${NC} ${WHITE}com.android.chrome${NC} - Chrome Browser"
echo -e "  ${GREEN}â€¢${NC} ${WHITE}com.whatsapp${NC} - WhatsApp"
echo -e "  ${GREEN}â€¢${NC} ${WHITE}com.instagram.android${NC} - Instagram"
echo -e "  ${GREEN}â€¢${NC} ${WHITE}com.google.android.youtube${NC} - YouTube"
echo -e "  ${GREEN}â€¢${NC} ${WHITE}com.facebook.katana${NC} - Facebook"
echo -e "  ${GREEN}â€¢${NC} ${WHITE}org.telegram.messenger${NC} - Telegram\n"

case $total_dev in
    1)
        echo -e "${YELLOW}${BOLD}ğŸ“± Single device detected:${NC}\n"
        display_device_box "1" "$dev_1" "${mod_1:-Unknown}" "${GREEN}â— Ready${NC}"
        
        echo -e "\n${CYAN}${BOLD}Starting app launcher...${NC}"
        sleep 1
        dev_1_launch
        ;;
        
    2)
        echo -e "${YELLOW}${BOLD}ğŸ“± Multiple devices detected:${NC}\n"
        display_device_box "1" "$dev_1" "${mod_1:-Unknown}" "${GREEN}â— Ready${NC}"
        echo
        display_device_box "2" "$dev_2" "${mod_2:-Unknown}" "${GREEN}â— Ready${NC}"
        
        echo -e "\n${CYAN}${BOLD}Select device to launch app:${NC}"
        while true; do
            echo -ne "\n${YELLOW}${BOLD}Enter device number (1-2) ${WHITE}â¤${NC} ${RED}"
            read options
            echo -ne "${NC}"
            
            case $options in
                1)
                    dev_1_launch
                    break
                    ;;
                2)
                    dev_2_launch
                    break
                    ;;
                *)
                    pulse_message "âŒ Invalid option! Choose 1 or 2" "${RED}"
                    ;;
            esac
        done
        ;;
        
    3)
        echo -e "${YELLOW}${BOLD}ğŸ“± Multiple devices detected:${NC}\n"
        display_device_box "1" "$dev_1" "${mod_1:-Unknown}" "${GREEN}â— Ready${NC}"
        echo
        display_device_box "2" "$dev_2" "${mod_2:-Unknown}" "${GREEN}â— Ready${NC}"
        echo
        display_device_box "3" "$dev_3" "${mod_3:-Unknown}" "${GREEN}â— Ready${NC}"
        
        echo -e "\n${CYAN}${BOLD}Select device to launch app:${NC}"
        while true; do
            echo -ne "\n${YELLOW}${BOLD}Enter device number (1-3) ${WHITE}â¤${NC} ${RED}"
            read options
            echo -ne "${NC}"
            
            case $options in
                1)
                    dev_1_launch
                    break
                    ;;
                2)
                    dev_2_launch
                    break
                    ;;
                3)
                    dev_3_launch
                    break
                    ;;
                *)
                    pulse_message "âŒ Invalid option! Choose 1-3" "${RED}"
                    ;;
            esac
        done
        ;;
esac

# Clean up temp files
rm -f .temp/dev_list_temp .temp/dev_list_model_temp .temp/pkglist_*.tmp 2>/dev/null

# Return options
echo -e "\n${YELLOW}${BOLD}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
echo -e "${CYAN}${BOLD}â Options:${NC}"
echo -e "  ${GREEN}â€¢${NC} Press ${WHITE}ENTER${NC} to return to main menu"
echo -e "  ${GREEN}â€¢${NC} Type ${WHITE}'launch'${NC} to launch another app"
echo -e "  ${GREEN}â€¢${NC} Type ${WHITE}'exit'${NC} to quit\n"

echo -ne "${YELLOW}${BOLD}â“ Your choice ${WHITE}â¤${NC} ${RED}"
read user_choice
echo -ne "${NC}"

case ${user_choice,,} in
    "launch")
        echo -e "\n${PURPLE}${BOLD}ğŸ”„ Launching another app...${NC}"
        sleep 1
        clear
        bash modules/opt26
        ;;
    "exit"|"quit")
        echo -e "\n${BLUE}${BOLD}ğŸ‘‹ Exiting to shell...${NC}"
        sparkle_effect
        exit 0
        ;;
    *)
        echo -e "\n${GREEN}${BOLD}â†©ï¸  Returning to main menu...${NC}"
        loading_animation "Loading"
        sleep 0.5
        clear
        bash modules/funtion.sh
        ;;
esac